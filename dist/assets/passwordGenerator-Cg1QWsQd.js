async function H(c){try{const l=await fetch("passwordGenerator.html");if(!l.ok)throw new Error(`Failed to load Password Generator HTML: ${l.status}`);const i=await l.text();if(i.includes("<!DOCTYPE html")||i.includes("<html"))throw new Error("Invalid HTML content - contains full page structure");c.innerHTML=i,N()}catch(l){console.error("Error loading Password Generator:",l),c.innerHTML='<div class="error">Failed to load Password Generator tool</div>';return}}function N(){const c={lower:"abcdefghijklmnopqrstuvwxyz",upper:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",digits:"0123456789",symbolsDefault:"!@#$%^&*()_-+=[]{};:,.?/~"},l=new Set("O0oIl1|S5B8Z2".split("")),i=new Set("{}[]()/\\'\"`~,;:.".split("")),o=e=>document.getElementById(e),d=o("pwgen-len"),p=o("pwgen-lenNum"),m=o("pwgen-lower"),f=o("pwgen-upper"),g=o("pwgen-digits"),y=o("pwgen-symbols"),v=o("pwgen-symset"),b=o("pwgen-noSimilar"),M=o("pwgen-noRepeat"),k=o("pwgen-noAmbig"),A=o("pwgen-count"),I=o("pwgen-btnGen"),L=o("pwgen-btnCopyAll"),S=o("pwgen-btnDownload"),x=o("pwgen-list"),C=o("pwgen-allOut"),j=o("pwgen-metaLen"),G=o("pwgen-metaPool"),P=o("pwgen-metaEntropy");d.addEventListener("input",()=>{p.value=d.value,u()}),p.addEventListener("input",()=>{const e=Math.min(128,Math.max(8,parseInt(p.value||8)));p.value=e,d.value=e,u()}),[m,f,g,y,v,b,k].forEach(e=>e.addEventListener("input",u));function T(){let e="";return m.checked&&(e+=c.lower),f.checked&&(e+=c.upper),g.checked&&(e+=c.digits),y.checked&&(e+=v.value||c.symbolsDefault),b.checked&&(e=[...e].filter(t=>!l.has(t)).join("")),k.checked&&(e=[...e].filter(t=>!i.has(t)).join("")),e=Array.from(new Set(e.split(""))).join(""),e}function u(){const e=parseInt(d.value),t=T();j.textContent=`Chars: ${e}`,G.textContent=`Pool: ${t.length}`;const n=t.length?e*Math.log2(t.length):0;P.textContent=`Entropy: ${n.toFixed(1)} bits`}u();function E(e){const t=new Uint32Array(1),n=Math.floor(4294967296/e)*e;for(;;){crypto.getRandomValues(t);const a=t[0];if(a<n)return a%e}}function O(e){for(let t=e.length-1;t>0;t--){const n=E(t+1);[e[t],e[n]]=[e[n],e[t]]}return e}function R(e,t){const n=O([...Array(e.length).keys()]);let a=0;for(const r of t){if(!r||!r.length)continue;const s=n[a++%n.length];e[s]=r[E(r.length)]}}function h(e){let t=e;return b.checked&&(t=[...t].filter(n=>!l.has(n)).join("")),k.checked&&(t=[...t].filter(n=>!i.has(n)).join("")),t}function B(){const e=parseInt(d.value),t=T();if(!t.length)throw new Error("No characters selected. Enable at least one set.");const n=[];m.checked&&n.push(h(c.lower)),f.checked&&n.push(h(c.upper)),g.checked&&n.push(h(c.digits)),y.checked&&n.push(h(v.value||c.symbolsDefault));const a=new Array(e);let r=null;for(let s=0;s<e;s++){let w;do w=t[E(t.length)];while(M.checked&&w===r&&t.length>1);a[s]=w,r=w}return R(a,n),a.join("")}function D(e){x.innerHTML="";const t=[];for(const n of e){t.push(n);const a=document.createElement("div");a.className="password-item";const r=document.createElement("div");r.className="password-text",r.textContent=n;const s=document.createElement("button");s.className="copy-btn",s.textContent="Copy",s.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n),s.textContent="Copied!",s.classList.add("copied"),setTimeout(()=>{s.textContent="Copy",s.classList.remove("copied")},900)}catch{alert("Failed to copy to clipboard")}}),a.appendChild(r),a.appendChild(s),x.appendChild(a)}C.value=t.join(`
`)}I.addEventListener("click",()=>{try{const e=Math.min(200,Math.max(1,parseInt(A.value||1))),t=Array.from({length:e},B);D(t)}catch(e){alert(e.message)}}),L.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(C.value),L.textContent="ðŸ“‹ Copied!",setTimeout(()=>L.textContent="ðŸ“‹ Copy All",900)}catch{alert("Clipboard copy failed.")}}),S.addEventListener("click",()=>{const e=new Blob([C.value],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="passwords.txt",document.body.appendChild(n),n.click(),setTimeout(()=>{URL.revokeObjectURL(t),n.remove()},0)})}async function F(c){if(!document.getElementById("passwordgen-css-link")){const l=document.createElement("link");l.id="passwordgen-css-link",l.rel="stylesheet",l.href="passwordGenerator.css",document.head.appendChild(l)}await H(c)}export{F as load,H as loadPasswordGeneratorTool,N as setupPasswordGeneratorTool};
