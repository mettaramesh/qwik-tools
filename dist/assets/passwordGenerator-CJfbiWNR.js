async function q(a){const r=await fetch("src/passwordGenerator.html").then(h=>h.text());a.innerHTML=r,z()}function z(){const a={lower:"abcdefghijklmnopqrstuvwxyz",upper:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",digits:"0123456789",symbolsDefault:"!@#$%^&*()_-+=[]{};:,.?/~"},r=new Set("O0oIl1|S5B8Z2".split("")),h=new Set("{}[]()/\\'\"`~,;:.".split("")),o=e=>document.getElementById(e),u=o("pwgen-len"),m=o("pwgen-lenNum"),w=o("pwgen-lower"),y=o("pwgen-upper"),b=o("pwgen-digits"),k=o("pwgen-symbols"),v=o("pwgen-symset"),C=o("pwgen-noSimilar"),I=o("pwgen-noRepeat"),E=o("pwgen-noAmbig"),S=o("pwgen-count"),N=o("pwgen-btnGen"),x=o("pwgen-btnCopyAll"),R=o("pwgen-btnDownload"),A=o("pwgen-list"),L=o("pwgen-allOut"),B=o("pwgen-metaLen"),G=o("pwgen-metaPool"),O=o("pwgen-metaEntropy");u.addEventListener("input",()=>{m.value=u.value,f()}),m.addEventListener("input",()=>{const e=Math.min(128,Math.max(8,parseInt(m.value||8)));m.value=e,u.value=e,f()}),[w,y,b,k,v,C,E].forEach(e=>e.addEventListener("input",f));function M(){let e="";return w.checked&&(e+=a.lower),y.checked&&(e+=a.upper),b.checked&&(e+=a.digits),k.checked&&(e+=v.value||a.symbolsDefault),C.checked&&(e=[...e].filter(t=>!r.has(t)).join("")),E.checked&&(e=[...e].filter(t=>!h.has(t)).join("")),e=Array.from(new Set(e.split(""))).join(""),e}function f(){const e=parseInt(u.value),t=M();B.textContent=`Chars: ${e}`,G.textContent=`Pool: ${t.length}`;const n=t.length?e*Math.log2(t.length):0;O.textContent=`Entropy: ${n.toFixed(1)} bits`}f();function T(e){const t=new Uint32Array(1),n=Math.floor(4294967296/e)*e;for(;;){crypto.getRandomValues(t);const s=t[0];if(s<n)return s%e}}function P(e){for(let t=e.length-1;t>0;t--){const n=T(t+1);[e[t],e[n]]=[e[n],e[t]]}return e}function D(e,t){const n=P([...Array(e.length).keys()]);let s=0;for(const c of t){if(!c||!c.length)continue;const i=n[s++%n.length];e[i]=c[T(c.length)]}}function g(e){let t=e;return C.checked&&(t=[...t].filter(n=>!r.has(n)).join("")),E.checked&&(t=[...t].filter(n=>!h.has(n)).join("")),t}function U(){const e=parseInt(u.value),t=M();if(!t.length)throw new Error("No characters selected. Enable at least one set.");const n=[];w.checked&&n.push(g(a.lower)),y.checked&&n.push(g(a.upper)),b.checked&&n.push(g(a.digits)),k.checked&&n.push(g(v.value||a.symbolsDefault));const s=new Array(e);let c=null;for(let i=0;i<e;i++){let l;do l=t[T(t.length)];while(I.checked&&l===c&&t.length>1);s[i]=l,c=l}return D(s,n),s.join("")}function $(e){const t=M();return e.length*Math.log2(t.length||1)}function F(e){const t=Math.pow(2,Math.max(e-1,0))/1e10;if(t<1)return"<1s";const n=[["yr",365*24*3600],["d",24*3600],["h",3600],["m",60],["s",1]];let s=t,c=[];for(const[i,l]of n)if(s>=l){const d=Math.floor(s/l);if(c.push(d+i),s-=d*l,c.length>=2)break}return c.join(" ")}function H(e){return e<45?"#ff6b6b":e<60?"#ffb86b":"#4cd2a0"}function V(e){A.innerHTML="";const t=[];for(const n of e){t.push(n);const s=document.createElement("div");s.className="pwd";const c=document.createElement("code");c.textContent=n;const i=document.createElement("div");i.className="meter";const l=document.createElement("div");l.className="bar";const d=$(n),Z=Math.max(6,Math.min(100,Math.round(d/80*100)));l.style.width=Z+"%",l.style.background=H(d),i.appendChild(l);const j=document.createElement("span");j.className="small",j.textContent=` ${d.toFixed(1)} bits â€¢ ~${F(d)}`;const p=document.createElement("button");p.className="btn btn--outline",p.textContent="Copy",p.addEventListener("click",async()=>{await navigator.clipboard.writeText(n),p.textContent="Copied!",setTimeout(()=>p.textContent="Copy",900)}),s.appendChild(c),s.appendChild(i),s.appendChild(j),s.appendChild(p),A.appendChild(s)}L.value=t.join(`
`)}N.addEventListener("click",()=>{try{const e=Math.min(200,Math.max(1,parseInt(S.value||1))),t=Array.from({length:e},U);V(t)}catch(e){alert(e.message)}}),x.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(L.value),x.textContent="Copied!",setTimeout(()=>x.textContent="Copy all",900)}catch{alert("Clipboard copy failed.")}}),R.addEventListener("click",()=>{const e=new Blob([L.value],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="passwords.txt",document.body.appendChild(n),n.click(),setTimeout(()=>{URL.revokeObjectURL(t),n.remove()},0)})}async function J(a){if(!document.getElementById("passwordgen-css-link")){const r=document.createElement("link");r.id="passwordgen-css-link",r.rel="stylesheet",r.href="passwordGenerator.css",document.head.appendChild(r)}await q(a)}export{J as load,q as loadPasswordGeneratorTool,z as setupPasswordGeneratorTool};
