async function Z(l){try{const a=await fetch("src/passwordGenerator.html");if(!a.ok)throw new Error(`Failed to load Password Generator HTML: ${a.status}`);const p=await a.text();if(p.includes("<!DOCTYPE html")||p.includes("<html"))throw new Error("Invalid HTML content - contains full page structure");l.innerHTML=p,q()}catch(a){console.error("Error loading Password Generator:",a),l.innerHTML='<div class="error">Failed to load Password Generator tool</div>';return}}function q(){const l={lower:"abcdefghijklmnopqrstuvwxyz",upper:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",digits:"0123456789",symbolsDefault:"!@#$%^&*()_-+=[]{};:,.?/~"},a=new Set("O0oIl1|S5B8Z2".split("")),p=new Set("{}[]()/\\'\"`~,;:.".split("")),o=e=>document.getElementById(e),h=o("pwgen-len"),m=o("pwgen-lenNum"),g=o("pwgen-lower"),y=o("pwgen-upper"),b=o("pwgen-digits"),v=o("pwgen-symbols"),k=o("pwgen-symset"),C=o("pwgen-noSimilar"),A=o("pwgen-noRepeat"),E=o("pwgen-noAmbig"),S=o("pwgen-count"),G=o("pwgen-btnGen"),L=o("pwgen-btnCopyAll"),P=o("pwgen-btnDownload"),j=o("pwgen-list"),x=o("pwgen-allOut"),N=o("pwgen-metaLen"),O=o("pwgen-metaPool"),R=o("pwgen-metaEntropy");h.addEventListener("input",()=>{m.value=h.value,f()}),m.addEventListener("input",()=>{const e=Math.min(128,Math.max(8,parseInt(m.value||8)));m.value=e,h.value=e,f()}),[g,y,b,v,k,C,E].forEach(e=>e.addEventListener("input",f));function M(){let e="";return g.checked&&(e+=l.lower),y.checked&&(e+=l.upper),b.checked&&(e+=l.digits),v.checked&&(e+=k.value||l.symbolsDefault),C.checked&&(e=[...e].filter(t=>!a.has(t)).join("")),E.checked&&(e=[...e].filter(t=>!p.has(t)).join("")),e=Array.from(new Set(e.split(""))).join(""),e}function f(){const e=parseInt(h.value),t=M();N.textContent=`Chars: ${e}`,O.textContent=`Pool: ${t.length}`;const n=t.length?e*Math.log2(t.length):0;R.textContent=`Entropy: ${n.toFixed(1)} bits`}f();function T(e){const t=new Uint32Array(1),n=Math.floor(4294967296/e)*e;for(;;){crypto.getRandomValues(t);const s=t[0];if(s<n)return s%e}}function B(e){for(let t=e.length-1;t>0;t--){const n=T(t+1);[e[t],e[n]]=[e[n],e[t]]}return e}function D(e,t){const n=B([...Array(e.length).keys()]);let s=0;for(const c of t){if(!c||!c.length)continue;const i=n[s++%n.length];e[i]=c[T(c.length)]}}function w(e){let t=e;return C.checked&&(t=[...t].filter(n=>!a.has(n)).join("")),E.checked&&(t=[...t].filter(n=>!p.has(n)).join("")),t}function H(){const e=parseInt(h.value),t=M();if(!t.length)throw new Error("No characters selected. Enable at least one set.");const n=[];g.checked&&n.push(w(l.lower)),y.checked&&n.push(w(l.upper)),b.checked&&n.push(w(l.digits)),v.checked&&n.push(w(k.value||l.symbolsDefault));const s=new Array(e);let c=null;for(let i=0;i<e;i++){let r;do r=t[T(t.length)];while(A.checked&&r===c&&t.length>1);s[i]=r,c=r}return D(s,n),s.join("")}function $(e){const t=M();return e.length*Math.log2(t.length||1)}function F(e){const t=Math.pow(2,Math.max(e-1,0))/1e10;if(t<1)return"<1s";const n=[["yr",365*24*3600],["d",24*3600],["h",3600],["m",60],["s",1]];let s=t,c=[];for(const[i,r]of n)if(s>=r){const d=Math.floor(s/r);if(c.push(d+i),s-=d*r,c.length>=2)break}return c.join(" ")}function U(e){return e<45?"#ff6b6b":e<60?"#ffb86b":"#4cd2a0"}function V(e){j.innerHTML="";const t=[];for(const n of e){t.push(n);const s=document.createElement("div");s.className="pwd";const c=document.createElement("code");c.textContent=n;const i=document.createElement("div");i.className="meter";const r=document.createElement("div");r.className="bar";const d=$(n),Y=Math.max(6,Math.min(100,Math.round(d/80*100)));r.style.width=Y+"%",r.style.background=U(d),i.appendChild(r);const I=document.createElement("span");I.className="small",I.textContent=` ${d.toFixed(1)} bits â€¢ ~${F(d)}`;const u=document.createElement("button");u.className="btn btn--outline",u.textContent="Copy",u.addEventListener("click",async()=>{await navigator.clipboard.writeText(n),u.textContent="Copied!",setTimeout(()=>u.textContent="Copy",900)}),s.appendChild(c),s.appendChild(i),s.appendChild(I),s.appendChild(u),j.appendChild(s)}x.value=t.join(`
`)}G.addEventListener("click",()=>{try{const e=Math.min(200,Math.max(1,parseInt(S.value||1))),t=Array.from({length:e},H);V(t)}catch(e){alert(e.message)}}),L.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(x.value),L.textContent="Copied!",setTimeout(()=>L.textContent="Copy all",900)}catch{alert("Clipboard copy failed.")}}),P.addEventListener("click",()=>{const e=new Blob([x.value],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="passwords.txt",document.body.appendChild(n),n.click(),setTimeout(()=>{URL.revokeObjectURL(t),n.remove()},0)})}async function z(l){if(!document.getElementById("passwordgen-css-link")){const a=document.createElement("link");a.id="passwordgen-css-link",a.rel="stylesheet",a.href="passwordGenerator.css",document.head.appendChild(a)}await Z(l)}export{z as load,Z as loadPasswordGeneratorTool,q as setupPasswordGeneratorTool};
