const k=new Set(["select","from","where","group by","order by","having","limit","offset","insert","into","values","update","set","delete","with","union","except","intersect","create","table","primary key","foreign key","references","alter","drop","add","column","index","view","exists"]),j=new Set(["and","or","on","as","by","into","using","when","then","else"]),L=new Set(["select","from","where","group by","order by","having","limit","offset","insert","update","delete","with","union","except","intersect"]);function S(e){return/\s/.test(e)}function A(e){return/[A-Za-z_@#]/.test(e)}function F(e){return/[A-Za-z0-9_\$@#]/.test(e)}function U(e){const t=[];let n=0;const s=e.length;for(;n<s;){const a=e[n];if(S(a)){let o=n+1;for(;o<s&&S(e[o]);)o++;t.push({type:"space",value:" "}),n=o;continue}if(a==="-"&&e[n+1]==="-"){let o=n+2;for(;o<s&&e[o]!==`
`;)o++;t.push({type:"comment",value:e.slice(n,o)}),n=o;continue}if(a==="/"&&e[n+1]==="*"){let o=n+2;for(;o<s&&!(e[o]==="*"&&e[o+1]==="/");)o++;o=Math.min(o+2,s),t.push({type:"comment",value:e.slice(n,o)}),n=o;continue}if(a==="'"||a==='"'){const o=a;let i=n+1,l=o;for(;i<s;){if(l+=e[i],e[i]===o)if(e[i+1]===o){i+=2,l+=e[i-1]||"";continue}else{i++;break}i++}t.push({type:"string",value:l}),n=i;continue}if(a==="`"||a==="["){const o=a,i=a==="["?"]":"`";let l=n+1,h=o;for(;l<s;){if(h+=e[l],e[l]===i){l++;break}l++}t.push({type:"identifier",value:h}),n=l;continue}if(a==="$"){const o=e.slice(n).match(/^\$[A-Za-z0-9_]*\$/);if(o){const i=o[0];let l=n+i.length,h=e.indexOf(i,l);h===-1&&(h=s);const d=e.slice(n,h+i.length);t.push({type:"string",value:d}),n=h+i.length;continue}}if(a==="("||a===")"||a===","||a===";"){t.push({type:"punct",value:a}),n++;continue}if(["=","+","-","*","/","%","<",">","!","|","&","^","~"].includes(a)){let o=n+1;for(;o<s&&/[=<>]/.test(e[o]);)o++;t.push({type:"op",value:e.slice(n,o)}),n=o;continue}if(A(a)||/[0-9]/.test(a)){let o=n;for(;o<s&&(F(e[o])||e[o]===".");)o++;const i=e.slice(n,o);t.push({type:"word",value:i}),n=o;continue}t.push({type:"char",value:a}),n++}return t}function E(e,t={}){if(!e||!e.trim())return"";e=e.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const n=U(e),s=[];let a=0;const o="  ";let i=0,l=null,h=!1;function d(){if(s.length===0){s.push(`
`),h=!1;return}s[s.length-1].endsWith(`
`)||(s.push(`
`),h=!1)}function p(){let r="";for(let w=0;w<a;w++)r+=o;s.push(r),h=!0}function f(r){s.push(r),h=!0}function v(){if(!(s.length?s[s.length-1]:"")){s.push("");return}const w=s.join("").slice(-1);w!==" "&&w!==`
`&&s.push(" ")}function g(r){d(),p(),f(r.toUpperCase()),l=r.toLowerCase(),h=!0}for(;i<n.length;){const r=n[i];if(r.type==="space"){i++;continue}if(r.type==="comment"){d(),p(),f(r.value.trim()),d(),i++;continue}(u=>{const y=[];let m=u;for(;m<n.length&&y.length<3;){if(n[m].type==="space"){m++;continue}if(n[m].type==="word")y.push(n[m].value.toLowerCase()),m++;else break}return y.join(" ")})(i);let b=null;for(const u of[3,2,1]){const y=[];let m=i;for(;m<n.length&&y.length<u;){if(n[m].type==="space"){m++;continue}if(n[m].type==="word")y.push(n[m].value.toLowerCase()),m++;else break}if(!y.length)continue;const C=y.join(" ");if(L.has(C)||k.has(C)){b=C;break}}if(b){if(["union","except","intersect"].includes(b)){d(),p(),f(b.toUpperCase()),d(),i+=b.split(" ").length,l=b;continue}g(b);let u=b.split(" ").length,y=0;for(;y<u&&i<n.length;){if(n[i].type==="space"){i++;continue}i++,y++}b.toLowerCase();continue}if(r.type==="punct"&&r.value==="("){v(),f("("),a++,i++;continue}if(r.type==="punct"&&r.value===")"){a=Math.max(0,a-1),d(),p(),f(")"),i++;continue}if(r.type==="punct"&&r.value===","){f(","),["select","group by","order by","values","set"].includes(l)?(d(),p(),l==="select"&&p()):v(),i++;continue}if(r.type==="punct"&&r.value===";"){f(";"),d(),i++;continue}if(r.type==="string"||r.type==="identifier"){v(),f(r.value),i++;continue}if(r.type==="op"||r.type==="char"){v(),f(r.value),i++;continue}if(r.type==="word"){const u=r.value.toLowerCase();if(u==="case"){d(),p(),f("CASE"),a++,l="case",i++;continue}if(u==="when"||u==="then"){d(),p(),p(),f(r.value.toUpperCase()),i++;continue}if(u==="else"){d(),p(),f("ELSE"),i++;continue}if(u==="end"){a=Math.max(0,a-1),d(),p(),f("END"),i++;continue}if(u==="join"||u.endsWith("join")){d(),p(),f(r.value.toUpperCase()),l="join",i++;continue}if(u==="on"){d(),p(),f("ON"),v(),i++;continue}if(u==="and"||u==="or"){d(),p(),f(u.toUpperCase()),v(),i++;continue}if(L.has(u)){g(u),l=u,i++;continue}const y=r.value.toUpperCase();if((j.has(u)||k.has(u)||/^[A-Za-z]+$/.test(r.value)&&/[^a-z]/i.test(y)===!1)&&(k.has(u)||j.has(u)||L.has(u)||["select","from","where","group","order","having","limit","offset","insert","update","delete"].includes(u))){h?v():p(),f(y),l=u,i++;continue}h?v():p(),f(r.value),i++;continue}v(),f(r.value),i++}return s.join("").split(`
`).map(r=>r.replace(/[ \t]+$/,"")).join(`
`).replace(/^\n+/,"").replace(/\n+$/,"")}function M(e){if(!e)return"";let t=0,n=e.length,s="";for(;t<n;){if(e[t]==="'"||e[t]==='"'){const a=e[t];for(s+=a,t++;t<n;){if(s+=e[t],e[t]===a)if(e[t+1]===a){t+=2,s+=e[t-1]||"";continue}else{t++;break}t++}continue}if(e[t]==="-"&&e[t+1]==="-"){for(;t<n&&e[t]!==`
`;)t++;continue}if(e[t]==="/"&&e[t+1]==="*"){for(t+=2;t<n&&!(e[t]==="*"&&e[t+1]==="/");)t++;t+=2;continue}if(S(e[t])){for(s+=" ";t<n&&S(e[t]);)t++;continue}s+=e[t],t++}return s.trim().replace(/\s*,\s*/g,", ").replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")")}function K(e){e.innerHTML=`
    <div class="tool-header"><h2>SQL Formatter</h2><p class="small">Format, beautify, or minify SQL queries â€” robust tokenizer & formatter.</p></div>
    <div class="card">
  <div class="sql-flex-row">
        <button class="btn btn--secondary" id="sql-format-btn">Format</button>
        <button class="btn btn--outline" id="sql-minify-btn">Minify</button>
        <button class="btn btn--outline" id="sql-clear-btn">Clear</button>
  <label class="sql-label-flex">
          <input type="checkbox" id="preserve-case" /> Preserve case (don't uppercase keywords)
        </label>
      </div>

  <div class="sql-flex-wrap">
  <div class="sql-flex-1">
          <div class="sql-flex-between">
            <label class="form-label">Input SQL</label>
            <button class="btn btn--sm copy-btn" data-target="sql-input">Copy</button>
          </div>
          <textarea id="sql-input" class="form-control code-input sql-mono" placeholder="Paste or type your SQL here..." rows="12"></textarea>
        </div>
  <div class="sql-flex-1">
          <div class="sql-flex-between">
            <label class="form-label">Formatted Output</label>
            <button class="btn btn--sm copy-btn" data-target="sql-output">Copy</button>
          </div>
          <textarea id="sql-output" class="form-control code-input sql-mono" readonly rows="12"></textarea>
        </div>
      </div>

  <div id="sql-error" class="error-message hidden sql-error-mt"></div>
    </div>
  `}function Q(e){if(!e||typeof e.querySelector!="function")throw new Error("SQL Formatter setup: container argument is required and must be a DOM element.");const t=e,n=t.querySelector("#sql-input"),s=t.querySelector("#sql-output"),a=t.querySelector("#sql-format-btn"),o=t.querySelector("#sql-minify-btn"),i=t.querySelector("#sql-clear-btn"),l=t.querySelector("#sql-error"),h=t.querySelectorAll(".copy-btn"),d=t.querySelector("#preserve-case"),p=document.createElement("span");p.className="small muted",p.style.marginLeft="12px",s.parentElement.appendChild(p);function f(c,x=!0,r=2200){p.textContent=c||"",p.style.color=x?"var(--color-success,#21808d)":"var(--color-error,#c0392b)",r&&c&&setTimeout(()=>{p.textContent===c&&(p.textContent="")},r)}function v(c){l.textContent=c,l.classList.remove("hidden")}function g(){l&&(l.textContent="",l.classList.add("hidden"))}a.addEventListener("click",()=>{g();try{let c=E(n.value||"");d.checked||(c=c.replace(/\b(select|from|where|group by|order by|having|limit|offset|insert|into|values|update|set|delete|with|union|except|intersect|join|left join|right join|inner join|outer join|on|as|and|or|case|when|then|else|end|in|is|null|not|create|table|primary key|foreign key|references|alter|drop|add|column|index|view|exists|between|like|desc|asc|cast|coalesce|with|recursive)\b/gi,x=>x.toUpperCase())),s.value=c,f("Formatted",!0)}catch(c){v("Formatting error: "+(c&&c.message?c.message:String(c)))}}),o.addEventListener("click",()=>{g();try{const c=M(n.value||"");s.value=c,f("Minified",!0)}catch(c){v("Minify error: "+(c&&c.message?c.message:String(c)))}}),i.addEventListener("click",()=>{n.value="",s.value="",g(),f("Cleared",!0)}),h.forEach(c=>{c.addEventListener("click",async x=>{const r=c.getAttribute("data-target"),w=t.querySelector(`#${r}`);if(w)try{await navigator.clipboard.writeText(w.value),f("Copied!",!0)}catch{f("Copy failed.",!1)}})}),t.addEventListener("keydown",c=>{(navigator.platform.toLowerCase().includes("mac")?c.metaKey:c.ctrlKey)&&(c.shiftKey&&c.key.toLowerCase()==="f"?(c.preventDefault(),a.click()):c.shiftKey&&c.key.toLowerCase()==="m"&&(c.preventDefault(),o.click()))}),n.addEventListener("focus",()=>n.select())}const $={load:K,setup:Q,formatSQL:E,minifySQL:M};export{$ as default,K as load,Q as setup};
