async function I(i){try{const n=await fetch("numberBaseTool.html");if(!n.ok)throw new Error(`Failed to load Number Base Tool HTML: ${n.status}`);const f=await n.text();if(f.includes("<!DOCTYPE html")||f.includes("<html"))throw new Error("Invalid HTML content - contains full page structure");i&&(i.innerHTML=f,N())}catch(n){console.error("Error loading Number Base Tool:",n),i&&(i.innerHTML='<div class="error">Failed to load Number Base Tool</div>');return}}async function O(i){if(!document.getElementById("numberbase-css-link")){const n=document.createElement("link");n.id="numberbase-css-link",n.rel="stylesheet",n.href="/numberBaseTool.css",document.head&&document.head.appendChild(n)}await I(i)}function N(){const i=e=>document.getElementById(e),n={bin:i("nb-bin"),oct:i("nb-oct"),dec:i("nb-dec"),hex:i("nb-hex"),custom:i("nb-custom")},f={bin:i("nb-binMsg"),oct:i("nb-octMsg"),dec:i("nb-decMsg"),hex:i("nb-hexMsg"),custom:i("nb-customMsg")},B=i("signedToggle"),h=i("groupSize"),g=i("prefixes"),a=i("customBase");if(a){for(let e=2;e<=36;e++){const t=document.createElement("option");t.value=String(e),t.textContent=`Base ${e}`,e===5&&(t.textContent+=" · quinary"),e===8&&(t.textContent+=" · octal"),e===10&&(t.textContent+=" · decimal"),e===12&&(t.textContent+=" · dozenal"),e===16&&(t.textContent+=" · hex"),a.appendChild(t)}a.value="7"}const p="0123456789abcdefghijklmnopqrstuvwxyz";function k(e){return(e||"").trim().toLowerCase().replace(/[_\s]/g,"")}function M(e,t){const o=e<=10?`[0-${e-1}]`:`[0-9a-${p[e-1]}]`,r=t?"-?":"";return new RegExp(`^${r}(?:${o})+$`)}function S(e,t,o){const r=k(e);if(!r)return null;if(!M(t,o).test(r))throw new Error(`Invalid digits for base ${t}`);let l=!1,u=0;o&&r[0]==="-"&&(l=!0,u=1);let c=0n;for(;u<r.length;u++){const E=r[u],m=BigInt(p.indexOf(E));if(m<0n||m>=BigInt(t))throw new Error("Bad digit");c=c*BigInt(t)+m}return l?-c:c}function $(e,t){if(!t||t<=0)return e;e=e.replace(/\s+/g,"");let o="",r=0;for(let s=e.length-1;s>=0;s--)o=e[s]+o,r++,r%t===0&&s!==0&&(o=" "+o);return o}function w(e,t,o){if(e==null)return"";const r=e<0n;let s=r?-e:e;if(s===0n)return"0";let l="";const u=BigInt(t);for(;s>0n;){const c=s%u;l=p[Number(c)]+l,s=s/u}return l=$(l,o),r?"-"+l:l}function y(e){switch(e){case 2:return"0b";case 8:return"0o";case 16:return"0x";default:return""}}function d(e,t,o=!1){f[e].textContent=t,f[e].className=o?"ok":/Invalid|error/i.test(t)?"err":"hint"}function T(e){if(!n[e])return;const t={bin:2,oct:8,dec:10,hex:16,custom:a&&a.value?Number(a.value):2};let o=(n[e].value||"").trim();if(g&&g.value==="std"&&o){let r="",s=o;o.startsWith("-")&&(r="-",s=o.slice(1)),s=s.replace(/\s|_/g,"");const l=y(t[e]);o=r+(l||"")+s}navigator.clipboard.writeText(o).then(()=>{d(e,"Copied to clipboard ✔",!0),setTimeout(()=>d(e,x[e]),1400)}).catch(()=>{d(e,"Clipboard error",!1)})}const x={bin:"Digits: 0–1",oct:"Digits: 0–7",dec:"Digits: 0–9",hex:"Digits: 0–9 a–z",custom:"Base 2–36"};let b=!1;function v(e){if(b)return;b=!0;const t={bin:2,oct:8,dec:10,hex:16,custom:a&&a.value?Number(a.value):2},o=h&&h.value?Number(h.value):0;let r=null;try{if(!n[e]){b=!1;return}let c=n[e].value||"";c=D(c,t[e]),r=S(c,t[e],B&&B.checked),d(e,x[e])}catch(c){d(e,String(c&&c.message?c.message:c),!1),b=!1;return}["bin","oct","dec","hex","custom"].forEach(c=>{if(c===e||!n[c])return;const E=t[c];let m=w(r,E,o);m=L(m,E),n[c].value=m,d(c,x[c])});const l=t[e];let u=w(r,l,o);u=L(u,l),n[e]&&(n[e].value=u),b=!1}function D(e,t){return e=e.trim(),t===2&&e.startsWith("0b")||t===8&&e.startsWith("0o")||t===16&&e.startsWith("0x")?e.slice(2):e}function F(e){return g.value==="std"&&(e===2||e===8||e===16)}function L(e,t){if(!e)return"";let o="",r=e;return e.startsWith("-")&&(o="-",r=e.slice(1)),F(t)?o+y(t)+r.replace(/\s|_/g,""):e}Object.keys(n).forEach(e=>{n[e]&&(n[e].addEventListener("input",()=>v(e)),n[e].addEventListener("focus",()=>{f[e]&&(f[e].className="hint")}))}),document.querySelectorAll("[data-copy]").forEach(e=>{e.addEventListener("click",()=>T(e.dataset.copy))}),h&&h.addEventListener("change",()=>{const t=["dec","hex","bin","oct","custom"].find(o=>n[o]&&n[o].value&&n[o].value.trim()!=="")||"dec";v(t)}),g&&g.addEventListener("change",()=>{const e=["custom","dec","hex","bin","oct"].find(t=>n[t]&&n[t].value&&n[t].value.trim()!=="")||"dec";v(e)}),a&&a.addEventListener("change",()=>{const e=["custom","dec","hex","bin","oct"].find(t=>n[t]&&n[t].value&&n[t].value.trim()!=="")||"dec";v(e),d("custom",`Digits: 0–${a&&a.value?Number(a.value)-1:1} (a–${p[a&&a.value?Number(a.value)-1:1]||""} for ≥ 10)`)});const C=i("clearAll");C&&C.addEventListener("click",()=>{Object.values(n).forEach(e=>{e&&(e.value="")}),Object.keys(f).forEach(e=>{f[e]&&d(e,x[e])})}),document.addEventListener("keydown",e=>{var t;if(e.key==="Enter"&&(e.ctrlKey||e.metaKey)){const o=document.activeElement,r=(t=Object.entries(n).find(([,s])=>s===o))==null?void 0:t[0];r&&T(r)}}),n.dec&&(n.dec.value="2025"),n.dec&&v("dec")}const W={render:I,postLoad:N};export{W as default,O as load,I as loadNumberBaseTool,N as setupNumberBaseTool};
