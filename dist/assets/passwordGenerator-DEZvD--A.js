async function H(l){try{const r=await fetch("passwordGenerator.html");if(!r.ok)throw new Error(`Failed to load Password Generator HTML: ${r.status}`);const i=await r.text();if(i.includes("<!DOCTYPE html")||i.includes("<html"))throw new Error("Invalid HTML content - contains full page structure");l.innerHTML=i,N()}catch(r){console.error("Error loading Password Generator:",r),l.innerHTML='<div class="error">Failed to load Password Generator tool</div>';return}}function N(){const l={lower:"abcdefghijklmnopqrstuvwxyz",upper:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",digits:"0123456789",symbolsDefault:"!@#$%^&*()_-+=[]{};:,.?/~"},r=new Set("O0oIl1|S5B8Z2".split("")),i=new Set("{}[]()/\\'\"`~,;:.".split("")),o=e=>{const t=document.getElementById(e);return t||console.error(`Password Generator: Element with ID '${e}' not found`),t},d=o("pwgen-len"),p=o("pwgen-lenNum"),u=o("pwgen-lower"),h=o("pwgen-upper"),m=o("pwgen-digits"),f=o("pwgen-symbols"),E=o("pwgen-symset"),k=o("pwgen-noSimilar"),j=o("pwgen-noRepeat"),L=o("pwgen-noAmbig"),C=o("pwgen-count"),x=o("pwgen-btnGen"),w=o("pwgen-btnCopyAll"),I=o("pwgen-btnDownload"),M=o("pwgen-list"),g=o("pwgen-allOut"),A=o("pwgen-metaLen"),G=o("pwgen-metaPool"),P=o("pwgen-metaEntropy");if([d,p,u,h,m,f,x,M,g,A,G,P].filter(e=>!e).length>0){console.error("Password Generator: Required DOM elements are missing");return}d.addEventListener("input",()=>{p.value=d.value,y()}),p.addEventListener("input",()=>{const e=Math.min(128,Math.max(8,parseInt(p.value||8)));p.value=e,d.value=e,y()}),[u,h,m,f,E,k,L].forEach(e=>{e&&e.addEventListener("input",y)});function S(){let e="";return u.checked&&(e+=l.lower),h.checked&&(e+=l.upper),m.checked&&(e+=l.digits),f.checked&&(e+=E.value||l.symbolsDefault),k.checked&&(e=[...e].filter(t=>!r.has(t)).join("")),L.checked&&(e=[...e].filter(t=>!i.has(t)).join("")),e=Array.from(new Set(e.split(""))).join(""),e}function y(){const e=parseInt(d.value),t=S();A.textContent=`Chars: ${e}`,G.textContent=`Pool: ${t.length}`;const n=t.length?e*Math.log2(t.length):0;P.textContent=`Entropy: ${n.toFixed(1)} bits`}y();function T(e){const t=new Uint32Array(1),n=Math.floor(4294967296/e)*e;for(;;){crypto.getRandomValues(t);const c=t[0];if(c<n)return c%e}}function O(e){for(let t=e.length-1;t>0;t--){const n=T(t+1);[e[t],e[n]]=[e[n],e[t]]}return e}function R(e,t){const n=O([...Array(e.length).keys()]);let c=0;for(const a of t){if(!a||!a.length)continue;const s=n[c++%n.length];e[s]=a[T(a.length)]}}function v(e){let t=e;return k.checked&&(t=[...t].filter(n=>!r.has(n)).join("")),L.checked&&(t=[...t].filter(n=>!i.has(n)).join("")),t}function D(){const e=parseInt(d.value),t=S();if(!t.length)throw new Error("No characters selected. Enable at least one set.");const n=[];u.checked&&n.push(v(l.lower)),h.checked&&n.push(v(l.upper)),m.checked&&n.push(v(l.digits)),f.checked&&n.push(v(E.value||l.symbolsDefault));const c=new Array(e);let a=null;for(let s=0;s<e;s++){let b;do b=t[T(t.length)];while(j.checked&&b===a&&t.length>1);c[s]=b,a=b}return R(c,n),c.join("")}function B(e){M.innerHTML="";const t=[];for(const n of e){t.push(n);const c=document.createElement("div");c.className="password-item";const a=document.createElement("div");a.className="password-text",a.textContent=n;const s=document.createElement("button");s.className="copy-btn",s.textContent="Copy",s.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n),s.textContent="Copied!",s.classList.add("copied"),setTimeout(()=>{s.textContent="Copy",s.classList.remove("copied")},900)}catch{alert("Failed to copy to clipboard")}}),c.appendChild(a),c.appendChild(s),M.appendChild(c)}g.value=t.join(`
`)}x&&x.addEventListener("click",()=>{try{const e=Math.min(200,Math.max(1,parseInt((C==null?void 0:C.value)||1))),t=Array.from({length:e},D);B(t)}catch(e){alert(e.message)}}),w&&w.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(g.value),w.textContent="ðŸ“‹ Copied!",setTimeout(()=>w.textContent="ðŸ“‹ Copy All",900)}catch{alert("Clipboard copy failed.")}}),I&&I.addEventListener("click",()=>{const e=new Blob([g.value],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="passwords.txt",document.body.appendChild(n),n.click(),setTimeout(()=>{URL.revokeObjectURL(t),n.remove()},0)})}async function $(l){if(!document.getElementById("passwordgen-css-link")){const r=document.createElement("link");r.id="passwordgen-css-link",r.rel="stylesheet",r.href="passwordGenerator.css",document.head.appendChild(r)}await H(l)}export{$ as load,H as loadPasswordGeneratorTool,N as setupPasswordGeneratorTool};
