async function Te(d,ye){try{const e=await fetch("textComparer.html");if(!e.ok)throw new Error(`Failed to load Text Comparer HTML: ${e.status}`);const t=await e.text();if(t.includes("<!DOCTYPE html")||t.includes("<html"))throw new Error("Invalid HTML content - contains full page structure");d.innerHTML=t}catch(e){console.error("Error loading Text Comparer:",e),d.innerHTML='<div class="error">Failed to load Text Comparer tool</div>';return}const f=d.querySelector("#tc-text1"),u=d.querySelector("#tc-text2"),g=d.querySelector("#gutter-left"),m=d.querySelector("#gutter-right"),ne=d.querySelector("#tc-compare"),re=d.querySelector("#tc-clear"),le=d.querySelector("#tc-copy"),L=d.querySelector("#tc-result"),A=d.querySelector("#tc-status"),W=d.querySelector("#tc-similarity"),se=d.querySelector("#tc-result-meta"),R=d.querySelector("#tc-search"),ie=d.querySelector("#tc-search-prev"),oe=d.querySelector("#tc-search-next"),B=d.querySelector("#tc-word-level"),D=d.querySelector("#tc-ignore-ws"),P=d.querySelector("#tc-ignore-case"),z=d.querySelector("#tc-show-lines"),$=d.querySelector("#splitter"),ce=d.querySelector("#tc-main"),X=d.querySelector("#left-wrap"),ae=d.querySelector("#right-wrap");function v(e,t=!0){A.textContent=e,A.classList.remove("status-ok","status-error"),A.classList.add(t?"status-ok":"status-error")}function F(e){se.textContent=e||""}function p(e){return String(e).replace(/[&<>]/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[t])}function de(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function q(e){const t=window.getComputedStyle(e);let n=parseFloat(t.lineHeight);if(isNaN(n)||t.lineHeight==="normal"){const r=parseFloat(t.fontSize)||13;n=Math.round(r*1.45)}return Math.round(n)}function J(e,t,n){const r=e.children.length;if(r>t)for(let s=r-1;s>=t;s--)e.removeChild(e.children[s]);else if(r<t){const s=document.createDocumentFragment();for(let i=r;i<t;i++){const l=document.createElement("div");l.className="ln",s.appendChild(l)}e.appendChild(s)}for(let s=0;s<t;s++){const i=e.children[s],l=String(s+1);i.textContent!==l&&(i.textContent=l),i.style.height=n+"px",i.style.lineHeight=n+"px"}}function k(){const e=Math.max(1,f.value.split(`
`).length),t=Math.max(1,u.value.split(`
`).length),n=q(f),r=q(u);J(g,e,n),J(m,t,r),z.checked?(g.classList.remove("hidden"),m.classList.remove("hidden")):(g.classList.add("hidden"),m.classList.add("hidden"))}function V(e,t){if(t<=0)return 0;let n=0;for(let r=0;r<t;r++){const s=e.indexOf(`
`,n);if(s===-1){n=e.length;break}n=s+1}return n}function G(e,t){return t.wordLevel?e.split(/(\s+|\b)/).map(n=>n===void 0?"":n):e.split("")}function K(e,t){let n=String(e);return t.ignoreWs&&(n=n.replace(/\s+/g,"")),t.ignoreCase&&(n=n.toLowerCase()),n}function fe(e,t,n){const r=e.length,s=t.length,i=Array(r+1).fill(null).map(()=>Array(s+1).fill(0));for(let l=r-1;l>=0;l--)for(let o=s-1;o>=0;o--)i[l][o]=n(e[l],t[o])?1+i[l+1][o+1]:Math.max(i[l+1][o],i[l][o+1]);return i}function U(e,t,n){const r=G(e,n),s=G(t,n),i=(h,T)=>K(h,n)===K(T,n),l=fe(r,s,i);let o=0,a=0,c="";for(;o<r.length||a<s.length;)o<r.length&&a<s.length&&i(r[o],s[a])?(c+=p(String(s[a])),o++,a++):a<s.length&&(o===r.length||l[o][a+1]>=l[o+1][a])?(c+=`<span class="diff-add">${p(String(s[a]))}</span>`,a++):o<r.length&&(a===s.length||l[o][a+1]<l[o+1][a])?(c+=`<span class="diff-del">${p(String(r[o]))}</span>`,o++):(o<r.length&&(c+=`<span class="diff-del">${p(String(r[o]))}</span>`,o++),a<s.length&&(c+=`<span class="diff-add">${p(String(s[a]))}</span>`,a++));return c}function Y(e){if(!e||!e.trim())return null;const t=e.trim();if(t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]"))try{return JSON.stringify(JSON.parse(t),null,2)}catch{}if(t.startsWith("<"))try{const r=new DOMParser().parseFromString(t,"application/xml");if(!r.querySelector("parsererror"))return ue(r)}catch{}return null}function ue(e){function t(n,r=""){if(n.nodeType===3){const a=n.nodeValue.trim();return a?r+p(a)+`
`:""}if(n.nodeType===8)return r+"<!--"+p(n.nodeValue)+`-->
`;if(n.nodeType!==1)return"";const s=n.nodeName;let i="";if(n.attributes&&n.attributes.length)for(let a=0;a<n.attributes.length;a++){const c=n.attributes[a];i+=` ${c.name}="${p(c.value)}"`}const l=Array.from(n.childNodes||[]);if(!l.length)return r+`<${s}${i}/>
`;const o=l.map(a=>t(a,r+"  ")).join("");return r+`<${s}${i}>
`+o+r+`</${s}>
`}return Array.from(e.childNodes).map(n=>t(n,"")).join("")}function he(e,t,n){const r=e.length,s=t.length;if(r===0||s===0)return{dp:[],n:r,m:s};const i=Array(r+1).fill(null).map(()=>Array(s+1).fill(0));for(let l=r-1;l>=0;l--)for(let o=s-1;o>=0;o--)i[l][o]=n(e[l],t[o])?1+i[l+1][o+1]:Math.max(i[l+1][o],i[l][o+1]);return{dp:i,n:r,m:s}}function pe(e,t,n={}){const r=Y(e)||e,s=Y(t)||t,i=r.split(`
`),l=s.split(`
`),o=(x,O)=>{if(!n.ignoreWs&&!n.ignoreCase)return x===O;const ee=n.ignoreWs?x.replace(/\s+/g,""):x,te=n.ignoreWs?O.replace(/\s+/g,""):O;return n.ignoreCase?ee.toLowerCase()===te.toLowerCase():ee===te},{dp:a}=he(i,l,o);let c=0,h=0,T="";for(;c<i.length||h<l.length;)if(c<i.length&&h<l.length&&o(i[c],l[h]))T+=`<div class="diff-line">${p(i[c])}</div>`,c++,h++;else if(h<l.length&&(c===i.length||a[c][h+1]>=a[c+1][h]))if(n.wordLevel&&c<i.length){const x=U(i[c],l[h],n);T+=`<div class="diff-line">${x}</div>`,c++,h++}else T+=`<div class="diff-line"><span class="diff-add">${p(l[h])}</span></div>`,h++;else if(c<i.length&&(h===l.length||a[c][h+1]<a[c+1][h]))if(n.wordLevel&&h<l.length){const x=U(i[c],l[h],n);T+=`<div class="diff-line">${x}</div>`,c++,h++}else T+=`<div class="diff-line"><span class="diff-del">${p(i[c])}</span></div>`,c++;else c<i.length&&(T+=`<div class="diff-line"><span class="diff-del">${p(i[c])}</span></div>`,c++),h<l.length&&(T+=`<div class="diff-line"><span class="diff-add">${p(l[h])}</span></div>`,h++);return{html:T,leftFormatted:r,rightFormatted:s}}function ge(e,t){const n=e.replace(/\s+/g,""),r=t.replace(/\s+/g,"");if(!n&&!r)return 100;const s=Math.min(n.length,r.length);let i=0;for(let l=0;l<s;l++)n[l]===r[l]&&i++;return Math.round(i/Math.max(n.length,r.length)*100)}let E=null,j=!1;function C(e=140){E&&clearTimeout(E),E=setTimeout(()=>{j||(j=!0,requestAnimationFrame(()=>{b(),j=!1})),E=null},e)}let S=null,Q=0,N=null;function me(){try{const e=new Worker("diff.worker.js");return v("Worker enabled"),e}catch{return v("Worker unavailable, using main thread",!1),null}}function Z(){if(S){try{S.terminate()}catch{}S=null}}function ve(e,t,n,r,s){if(S||(S=me()),!S){s&&s("Worker unavailable");return}Q++;const i=Q;S.postMessage({id:i,type:"compute",left:e,right:t,opts:n}),N=setTimeout(()=>{Z(),v("Worker timeout, using main thread",!1),s&&s("Worker timeout")},6e3),S.onmessage=l=>{!l.data||l.data.id!==i||(clearTimeout(N),l.data.type==="done"?r&&r(l.data.html,l.data.similarity,l.data.meta):l.data.type==="error"&&s&&s(l.data.message))},S.onerror=l=>{clearTimeout(N),Z(),v("Worker error, using main thread",!1),s&&s("Worker error")}}function b(e=!1){v("Computing diff...");const t=f.value,n=u.value,r={wordLevel:B.checked,ignoreWs:D.checked,ignoreCase:P.checked};ve(t,n,r,(s,i,l)=>{L.innerHTML=s||'<div class="tc-no-diff">No differences</div>',W.textContent=i?`Similarity: ${i}%`:"",F(l||""),v("Ready (worker)"),H()},s=>{const{html:i}=pe(t,n,r);L.innerHTML=i||'<div class="tc-no-diff">No differences</div>',W.textContent=`Similarity: ${ge(t,n)}%`,F(""),v("Ready (main thread)",!1),H()})}[B,D,P,z].forEach(e=>{e.addEventListener("change",()=>{k(),C(60)})}),ne.addEventListener("click",()=>b(!0)),R.addEventListener("input",()=>C(80)),le.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(L.innerText||""),v("Result copied to clipboard")}catch{v("Copy failed",!1)}}),re.addEventListener("click",()=>{f.value="",u.value="",L.innerHTML="",k(),v("Cleared"),W.textContent="",F(""),H()}),[f,u].forEach(e=>{e.addEventListener("input",()=>{k(),C()}),e.addEventListener("paste",()=>{setTimeout(()=>{k(),C()},20)}),e.addEventListener("keydown",t=>{(navigator.platform.toLowerCase().includes("mac")?t.metaKey:t.ctrlKey)&&t.key.toLowerCase()==="b"&&(t.preventDefault(),b())})}),!f.value&&!u.value?(f.value=`The quick brown fox
jumps over the lazy dog.
This is the left file.
It has several lines.
Some lines will be changed.`,u.value=`The quick brown fox
jumps over the lazy dog!
This is the right file.
It has several lines.
Some lines will be added.
And some will be removed.`,k(),C(20)):(k(),C(20)),function(){let t=0,n=0;$.addEventListener("pointerdown",r=>{r.preventDefault(),t=r.clientX,n=X.getBoundingClientRect().width,$.setPointerCapture(r.pointerId);function s(l){const o=l.clientX-t,a=ce.clientWidth;let c=Math.max(200,Math.min(a-200,n+o));X.style.flex=`0 0 ${c}px`,ae.style.flex=`0 0 ${Math.max(200,a-c-$.offsetWidth)}px`}function i(l){$.releasePointerCapture(l.pointerId),document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",i)}document.addEventListener("pointermove",s),document.addEventListener("pointerup",i)})}();function _(){f.addEventListener("scroll",()=>{g.scrollTop=f.scrollTop,Math.abs(u.scrollTop-f.scrollTop)>1&&(u.scrollTop=f.scrollTop),m.scrollTop=f.scrollTop},{passive:!0}),u.addEventListener("scroll",()=>{m.scrollTop=u.scrollTop,Math.abs(f.scrollTop-u.scrollTop)>1&&(f.scrollTop=u.scrollTop),g.scrollTop=u.scrollTop},{passive:!0}),g.addEventListener("click",e=>{const t=e.target.closest(".ln");if(!t)return;const n=Array.prototype.indexOf.call(g.children,t);M(f,n)}),m.addEventListener("click",e=>{const t=e.target.closest(".ln");if(!t)return;const n=Array.prototype.indexOf.call(m.children,t);M(u,n)})}_();function M(e,t){const n=V(e.value,t);e.focus(),e.setSelectionRange(n,n);const r=q(e);e.scrollTop=Math.max(0,t*r-e.clientHeight/2)}d.textComparer={update:b,getResultHtml:()=>L.innerHTML,getSimilarity:()=>W.textContent},v("Ready â€” checkboxes now applied to diff");let y=[],w=0;function H(){const e=(R.value||"").trim();let t=L.innerHTML;if(!e){L.innerHTML=t.replace(/<span class="diff-chg">(.*?)<\/span>/g,"$1"),y=[],w=0;return}t=t.replace(/<span class="diff-chg">(.*?)<\/span>/g,"$1");const n=new RegExp(de(e),"gi");let r=0;t=t.replace(n,s=>(r++,`<span class="diff-chg" data-match-idx="${r-1}">${p(s)}</span>`)),L.innerHTML=t,y=Array.from(L.querySelectorAll(".diff-chg")),w=0,I()}function I(){if(!y.length)return;y.forEach((t,n)=>{t.style.outline=n===w?"2px solid #2563eb":"",t.style.background=n===w?"#fff4ce":""});const e=y[w];e&&e.scrollIntoView({behavior:"smooth",block:"center"})}R.addEventListener("input",()=>{H()}),ie.addEventListener("click",()=>{y.length&&(w=(w-1+y.length)%y.length,I())}),oe.addEventListener("click",()=>{y.length&&(w=(w+1)%y.length,I())})}export{Te as load};
