<!DOCTYPE html>
<html>
<head>
    <title>Complete Text Comparer Integration Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
        .test-result { margin: 5px 0; }
        #navigation-test { height: 500px; width: 100%; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Complete Text Comparer Integration Test</h1>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Navigation Test (Full App)</h2>
        <iframe id="navigation-test" src="/"></iframe>
    </div>
    
    <script>
        const results = document.getElementById('test-results');
        
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = `${type.toUpperCase()}: ${message}`;
            results.appendChild(div);
            console.log(`${type.toUpperCase()}: ${message}`);
        }
        
        async function runCompleteTest() {
            addResult('Starting comprehensive textComparer integration test...', 'success');
            
            try {
                // Test 1: Check if textComparer.html is accessible
                addResult('Test 1: Checking textComparer.html accessibility...', 'success');
                const htmlResponse = await fetch('/textComparer.html');
                if (htmlResponse.ok) {
                    const htmlContent = await htmlResponse.text();
                    if (htmlContent.includes('tc-text1') && htmlContent.includes('tc-text2')) {
                        addResult('✓ textComparer.html is accessible and contains required elements', 'success');
                    } else {
                        addResult('✗ textComparer.html missing required elements', 'error');
                    }
                } else {
                    addResult('✗ textComparer.html not accessible', 'error');
                }
                
                // Test 2: Check if the latest textComparer JS module loads
                addResult('Test 2: Loading textComparer JS module...', 'success');
                const moduleResponse = await fetch('/assets/textComparer-rl5s2fLR.js');
                if (moduleResponse.ok) {
                    addResult('✓ textComparer-rl5s2fLR.js is accessible', 'success');
                    
                    // Try to dynamically import and test the module
                    const module = await import('/assets/textComparer-rl5s2fLR.js');
                    if (module.load && typeof module.load === 'function') {
                        addResult('✓ textComparer module exports load function', 'success');
                        
                        // Test 3: Create a test container and load the module
                        addResult('Test 3: Testing module loading...', 'success');
                        const testDiv = document.createElement('div');
                        testDiv.id = 'textcomparer-test-container';
                        document.body.appendChild(testDiv);
                        
                        await module.load(testDiv, 'text-comparer');
                        
                        // Check if essential elements were created
                        const text1 = testDiv.querySelector('#tc-text1');
                        const text2 = testDiv.querySelector('#tc-text2');
                        const result = testDiv.querySelector('#tc-result');
                        const status = testDiv.querySelector('#tc-status');
                        
                        if (text1 && text2 && result && status) {
                            addResult('✓ All essential DOM elements created successfully', 'success');
                            
                            // Test 4: Test basic functionality
                            addResult('Test 4: Testing basic functionality...', 'success');
                            text1.value = 'Hello World';
                            text2.value = 'Hello Universe';
                            
                            const compareBtn = testDiv.querySelector('#tc-compare');
                            if (compareBtn) {
                                compareBtn.click();
                                setTimeout(() => {
                                    if (result.innerHTML.trim()) {
                                        addResult('✓ Text comparison working', 'success');
                                    } else {
                                        addResult('⚠ Text comparison result empty', 'warning');
                                    }
                                }, 500);
                            } else {
                                addResult('✗ Compare button not found', 'error');
                            }
                        } else {
                            addResult('✗ Missing essential DOM elements after load', 'error');
                        }
                    } else {
                        addResult('✗ textComparer module missing load function', 'error');
                    }
                } else {
                    addResult('✗ textComparer-rl5s2fLR.js not accessible', 'error');
                }
                
                // Test 5: Check main index integration
                addResult('Test 5: Checking main app integration...', 'success');
                const indexResponse = await fetch('/assets/index-BNx_RRWJ.js');
                if (indexResponse.ok) {
                    addResult('✓ Main index-BNx_RRWJ.js is accessible', 'success');
                } else {
                    addResult('✗ Main index JS not accessible', 'error');
                }
                
                addResult('Integration test completed!', 'success');
                
            } catch (error) {
                addResult(`Test failed with error: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }
        
        // Wait for page load, then run tests
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(runCompleteTest, 1000);
        });
        
        // Test hash navigation after iframe loads
        setTimeout(() => {
            const iframe = document.getElementById('navigation-test');
            iframe.addEventListener('load', () => {
                addResult('Test 6: Testing hash navigation in iframe...', 'success');
                try {
                    // Try to navigate to text-comparer via hash
                    iframe.src = '/#text-comparer';
                    addResult('✓ Hash navigation URL set', 'success');
                } catch (error) {
                    addResult(`Hash navigation test failed: ${error.message}`, 'error');
                }
            });
        }, 2000);
    </script>
</body>
</html>